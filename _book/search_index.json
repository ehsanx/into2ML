[["prediction-from-binary-outcome.html", "Chapter 5 Prediction from binary outcome 5.1 Read previously saved data 5.2 Outcome levels (factor) 5.3 Variables 5.4 Model 5.5 Measuring prediction error 5.6 Cross-validation using caret", " Chapter 5 Prediction from binary outcome 5.1 Read previously saved data ObsData &lt;- readRDS(file = &quot;data/rhcAnalytic.RDS&quot;) 5.2 Outcome levels (factor) levels(ObsData$Death)=c(&quot;No&quot;,&quot;Yes&quot;) # this is useful for caret # ref: https://tinyurl.com/caretbin class(ObsData$Death) ## [1] &quot;factor&quot; table(ObsData$Death) ## ## No Yes ## 2013 3722 5.2.1 Prediction for death In this section, we show the regression fitting when outcome is binary (death). 5.3 Variables baselinevars &lt;- names(dplyr::select(ObsData, !c(Length.of.Stay,Death))) baselinevars ## [1] &quot;Disease.category&quot; &quot;Cancer&quot; &quot;Cardiovascular&quot; ## [4] &quot;Congestive.HF&quot; &quot;Dementia&quot; &quot;Psychiatric&quot; ## [7] &quot;Pulmonary&quot; &quot;Renal&quot; &quot;Hepatic&quot; ## [10] &quot;GI.Bleed&quot; &quot;Tumor&quot; &quot;Immunosupperssion&quot; ## [13] &quot;Transfer.hx&quot; &quot;MI&quot; &quot;age&quot; ## [16] &quot;sex&quot; &quot;edu&quot; &quot;DASIndex&quot; ## [19] &quot;APACHE.score&quot; &quot;Glasgow.Coma.Score&quot; &quot;blood.pressure&quot; ## [22] &quot;WBC&quot; &quot;Heart.rate&quot; &quot;Respiratory.rate&quot; ## [25] &quot;Temperature&quot; &quot;PaO2vs.FIO2&quot; &quot;Albumin&quot; ## [28] &quot;Hematocrit&quot; &quot;Bilirubin&quot; &quot;Creatinine&quot; ## [31] &quot;Sodium&quot; &quot;Potassium&quot; &quot;PaCo2&quot; ## [34] &quot;PH&quot; &quot;Weight&quot; &quot;DNR.status&quot; ## [37] &quot;Medical.insurance&quot; &quot;Respiratory.Diag&quot; &quot;Cardiovascular.Diag&quot; ## [40] &quot;Neurological.Diag&quot; &quot;Gastrointestinal.Diag&quot; &quot;Renal.Diag&quot; ## [43] &quot;Metabolic.Diag&quot; &quot;Hematologic.Diag&quot; &quot;Sepsis.Diag&quot; ## [46] &quot;Trauma.Diag&quot; &quot;Orthopedic.Diag&quot; &quot;race&quot; ## [49] &quot;income&quot; &quot;RHC.use&quot; 5.4 Model # adjust covariates out.formula2 &lt;- as.formula(paste(&quot;Death~ &quot;, paste(baselinevars, collapse = &quot;+&quot;))) fit2 &lt;- glm(out.formula2, data = ObsData, family = binomial(link = &quot;logit&quot;)) require(Publish) adj.fit2 &lt;- publish(fit2, digits=1)$regressionTable out.formula2 ## Death ~ Disease.category + Cancer + Cardiovascular + Congestive.HF + ## Dementia + Psychiatric + Pulmonary + Renal + Hepatic + GI.Bleed + ## Tumor + Immunosupperssion + Transfer.hx + MI + age + sex + ## edu + DASIndex + APACHE.score + Glasgow.Coma.Score + blood.pressure + ## WBC + Heart.rate + Respiratory.rate + Temperature + PaO2vs.FIO2 + ## Albumin + Hematocrit + Bilirubin + Creatinine + Sodium + ## Potassium + PaCo2 + PH + Weight + DNR.status + Medical.insurance + ## Respiratory.Diag + Cardiovascular.Diag + Neurological.Diag + ## Gastrointestinal.Diag + Renal.Diag + Metabolic.Diag + Hematologic.Diag + ## Sepsis.Diag + Trauma.Diag + Orthopedic.Diag + race + income + ## RHC.use adj.fit2 ## Variable Units OddsRatio CI.95 p-value ## 1 Disease.category ARF Ref ## 2 CHF 1.0 [0.8;1.4] 0.8 ## 3 Other 1.6 [1.3;2.0] &lt;0.1 ## 4 MOSF 1.0 [0.9;1.2] 0.7 ## 5 Cancer None Ref ## 6 Localized (Yes) 6.6 [2.2;19.4] &lt;0.1 ## 7 Metastatic 26.4 [8.3;83.6] &lt;0.1 ## 8 Cardiovascular 0 Ref ## 9 1 1.3 [1.0;1.5] &lt;0.1 ## 10 Congestive.HF 0 Ref ## 11 1 1.6 [1.3;1.9] &lt;0.1 ## 12 Dementia 0 Ref ## 13 1 1.3 [1.0;1.6] &lt;0.1 ## 14 Psychiatric 0 Ref ## 15 1 0.9 [0.7;1.2] 0.6 ## 16 Pulmonary 0 Ref ## 17 1 1.0 [0.9;1.2] 0.7 ## 18 Renal 0 Ref ## 19 1 1.3 [0.9;1.9] 0.2 ## 20 Hepatic 0 Ref ## 21 1 1.3 [0.9;1.8] 0.1 ## 22 GI.Bleed 0 Ref ## 23 1 1.2 [0.8;1.9] 0.3 ## 24 Tumor 0 Ref ## 25 1 0.3 [0.1;0.9] &lt;0.1 ## 26 Immunosupperssion 0 Ref ## 27 1 1.2 [1.1;1.4] &lt;0.1 ## 28 Transfer.hx 0 Ref ## 29 1 0.8 [0.7;1.0] &lt;0.1 ## 30 MI 0 Ref ## 31 1 0.8 [0.6;1.2] 0.3 ## 32 age [-Inf,50) Ref ## 33 [50,60) 1.4 [1.2;1.8] &lt;0.1 ## 34 [60,70) 2.1 [1.7;2.5] &lt;0.1 ## 35 [70,80) 2.1 [1.6;2.6] &lt;0.1 ## 36 [80, Inf) 2.8 [2.1;3.8] &lt;0.1 ## 37 sex Male Ref ## 38 Female 0.8 [0.7;0.9] &lt;0.1 ## 39 edu 1.0 [1.0;1.0] 0.4 ## 40 DASIndex 1.0 [0.9;1.0] &lt;0.1 ## 41 APACHE.score 1.0 [1.0;1.0] &lt;0.1 ## 42 Glasgow.Coma.Score 1.0 [1.0;1.0] &lt;0.1 ## 43 blood.pressure 1.0 [1.0;1.0] 0.4 ## 44 WBC 1.0 [1.0;1.0] 0.2 ## 45 Heart.rate 1.0 [1.0;1.0] 0.7 ## 46 Respiratory.rate 1.0 [1.0;1.0] 0.8 ## 47 Temperature 0.9 [0.9;1.0] &lt;0.1 ## 48 PaO2vs.FIO2 1.0 [1.0;1.0] 0.3 ## 49 Albumin 1.0 [0.9;1.1] 0.6 ## 50 Hematocrit 1.0 [1.0;1.0] &lt;0.1 ## 51 Bilirubin 1.0 [1.0;1.1] &lt;0.1 ## 52 Creatinine 1.0 [1.0;1.0] 0.9 ## 53 Sodium 1.0 [1.0;1.0] 0.7 ## 54 Potassium 1.0 [0.9;1.1] 0.9 ## 55 PaCo2 1.0 [1.0;1.0] 0.3 ## 56 PH 1.1 [0.5;2.3] 0.9 ## 57 Weight 1.0 [1.0;1.0] &lt;0.1 ## 58 DNR.status No Ref ## 59 Yes 2.6 [2.0;3.3] &lt;0.1 ## 60 Medical.insurance Medicaid Ref ## 61 Medicare 1.6 [1.2;2.0] &lt;0.1 ## 62 Medicare &amp; Medicaid 1.4 [1.0;1.9] &lt;0.1 ## 63 No insurance 1.5 [1.1;2.0] &lt;0.1 ## 64 Private 1.3 [1.1;1.7] &lt;0.1 ## 65 Private &amp; Medicare 1.3 [1.0;1.7] &lt;0.1 ## 66 Respiratory.Diag No Ref ## 67 Yes 1.2 [1.0;1.4] &lt;0.1 ## 68 Cardiovascular.Diag No Ref ## 69 Yes 1.2 [1.0;1.4] &lt;0.1 ## 70 Neurological.Diag No Ref ## 71 Yes 1.5 [1.2;1.9] &lt;0.1 ## 72 Gastrointestinal.Diag No Ref ## 73 Yes 1.3 [1.1;1.6] &lt;0.1 ## 74 Renal.Diag No Ref ## 75 Yes 0.8 [0.6;1.1] 0.2 ## 76 Metabolic.Diag No Ref ## 77 Yes 1.0 [0.8;1.4] 0.8 ## 78 Hematologic.Diag No Ref ## 79 Yes 2.7 [2.0;3.8] &lt;0.1 ## 80 Sepsis.Diag No Ref ## 81 Yes 1.1 [0.9;1.4] 0.2 ## 82 Trauma.Diag No Ref ## 83 Yes 0.8 [0.4;1.4] 0.4 ## 84 Orthopedic.Diag No Ref ## 85 Yes 1.4 [0.2;8.1] 0.7 ## 86 race white Ref ## 87 black 1.0 [0.8;1.2] 0.9 ## 88 other 1.1 [0.8;1.4] 0.7 ## 89 income $11-$25k Ref ## 90 $25-$50k 0.8 [0.7;1.0] &lt;0.1 ## 91 &gt; $50k 0.8 [0.6;1.1] 0.2 ## 92 Under $11k 1.2 [1.0;1.4] &lt;0.1 ## 93 RHC.use 1.4 [1.2;1.6] &lt;0.1 5.5 Measuring prediction error 5.5.1 AUC require(pROC) ## Loading required package: pROC ## Type &#39;citation(&quot;pROC&quot;)&#39; for a citation. ## ## Attaching package: &#39;pROC&#39; ## The following objects are masked from &#39;package:stats&#39;: ## ## cov, smooth, var obs.y2&lt;-ObsData$Death pred.y2 &lt;- predict(fit2, type = &quot;response&quot;) rocobj &lt;- roc(obs.y2, pred.y2) ## Setting levels: control = No, case = Yes ## Setting direction: controls &lt; cases rocobj ## ## Call: ## roc.default(response = obs.y2, predictor = pred.y2) ## ## Data: pred.y2 in 2013 controls (obs.y2 No) &lt; 3722 cases (obs.y2 Yes). ## Area under the curve: 0.7682 plot(rocobj) auc(rocobj) ## Area under the curve: 0.7682 5.5.2 Brier Score require(DescTools) ## Loading required package: DescTools ## Warning: package &#39;DescTools&#39; was built under R version 4.1.1 BrierScore(fit2) ## [1] 0.1812502 5.6 Cross-validation using caret # Using Caret package set.seed(504) # make a 5-fold CV require(caret) ctrl&lt;-trainControl(method = &quot;cv&quot;, number = 5, classProbs = TRUE, summaryFunction = twoClassSummary) # fit the model with formula = out.formula2 # use training method glm (have to specify family) fit.cv.bin&lt;-train(out.formula2, trControl = ctrl, data = ObsData, method = &quot;glm&quot;, family = binomial(), metric=&quot;ROC&quot;) fit.cv.bin ## Generalized Linear Model ## ## 5735 samples ## 50 predictor ## 2 classes: &#39;No&#39;, &#39;Yes&#39; ## ## No pre-processing ## Resampling: Cross-Validated (5 fold) ## Summary of sample sizes: 4587, 4589, 4587, 4589, 4588 ## Resampling results: ## ## ROC Sens Spec ## 0.7545115 0.4659618 0.8535653 # extract results from each test data summary.res &lt;- fit.cv.bin$resample summary.res ## ROC Sens Spec Resample ## 1 0.7444835 0.4739454 0.8630872 Fold1 ## 2 0.7544836 0.4502488 0.8561828 Fold2 ## 3 0.7786734 0.4739454 0.8738255 Fold3 ## 4 0.7350679 0.4626866 0.8373656 Fold4 ## 5 0.7598488 0.4689826 0.8373656 Fold5 mean(fit.cv.bin$resample$ROC) ## [1] 0.7545115 sd(fit.cv.bin$resample$ROC) ## [1] 0.01651437 "]]
